{
  "articles": [
    {
      "path": "about.html",
      "title": "Introduction and Motivation",
      "author": [],
      "contents": "\r\nIntroduction\r\n“Correlation does not imply causation.” You might have heard this saying from your intro statistics course, and we knew if we’d like to find some evidence that makes us believe the causation. In causal inference, we will investigate the causal relationship between treatment (policy/ dosage/ drug/ habits, etc.) and the outcome of interest. By assigning people to different groups, we try to use various methods to reach the causal conclusion on which group has a better outcome? To do this, we should estimate the “causal effect”.\r\nA common way of estimating this is to calculate the average causal effect (ACE), denoted by:\r\n\\(E[Y^{a=1}]- E[Y^{a=0}]\\).\r\nIn this formula, a represents the potential treatment assignment: \\(a=0\\) means the individual will not be assigned treatment (control), and \\(a=1\\) dictates receiving treatment. In causal inference study, a huge blind spot is that after we observe the data, we want to know what would happen to an individual if they were to be assigned into the other group; unfortunately, this can never happen. As a result, we use capital \\(A\\) to represent the actual treatment received, and \\(a\\) for potential treatment under causal inference studies. \\(Y\\) is the outcome - it can be either quantitative or indicative. Combining together, the formula above makes sense: it records the average difference in the potential outcome between treatment and control group.\r\nIn statistics, after defining some particular interests and writing them out as mathematical formulas, researchers look for estimators to estimate the true parameter (in our case, that is the ACE). Doubly Robust Estimator (DRE) is a nice one due to its unbiasedness, meaning its average is equivalent to the true value of parameter (ACE). The reason it is called “doubly” is from the fact that DRE is composed of two different estimators: Inverse Probability Weighting (IPW), and Outcome Regression Model (REG). While this may not make any sense, don’t worry - in the next section, “Regression and IPW”, we will firstly go through these two regular, popular approaches in estimating ACE, and see how our doubly robust estimator serves to combine them and become even more powerful!\r\nMotivation of the project\r\nEstimating causal effects from data is a fundamental problem in many fields, including health care, economics, and many (social) sciences subjects. Xiang comes from an economic background whereas Kristy comes from a biology background. We teamed up and decided to explore this new, popular method, Doubly Robust estimation (DRE), which is widely used in biostatistics and econometric applications in many Difference-in-Difference (DiD, another way to say we are examining causal effects) experiments and causal inference contexts.\r\n\r\n\r\n\r\n",
      "last_modified": "2023-04-14T10:52:27-05:00"
    },
    {
      "path": "dre.html",
      "title": "Doubly Robust Estimator",
      "author": [],
      "contents": "\r\nDRE is a combined method from REG and IPW\r\nProperties of DRE\r\nProof of DRE’s unbiasedness\r\nWhen IPW is misspecified, but REG is correct\r\nThe first situation is that when we have IPW model\r\nmisspecified:\r\n\\[\r\n\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\frac{E\\left[Y_{i} \\mid A=1\\right]}{\\widehat{P S}_{i}}\\right) \\neq E\\left[Y^{a=1}\\right]\\\\\r\n\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\frac{E\\left[Y_{i} \\mid A=0\\right]}{1-\\widehat{P S}_{i}}\\right) \\neq E\\left[Y^{a=0}\\right]\r\n\\]\r\nBut our REG model is correct:\r\n\\[\r\n\\frac{1}{n} \\sum_{i=1}^{n} \\hat{Y}_{i}^{a}=E\\left[Y^{a}\\right]\r\n\\]\r\nThen the true ACE will become:\r\n\\[\r\n\\scriptsize{\\begin{aligned}\r\nE\\left[\\widehat{\\left[D R E_{a=1}\\right.}-\\widehat{\\left. D R E_{a=0}\\right]}\\right] &= E\\left[\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\frac{A_{i}\\left(Y_{i}-\\hat{Y}_{i}^{a=1}\\right)}{\\widehat{P S_{i}}}+\\hat{Y}_{i}^{a=1}\\right)-\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\frac{\\left(1-A_{i}\\right)\\left(Y_{i}-\\hat{Y}_{i}^{a=0}\\right)}{1-{\\widehat PS_{i}}}+\\hat{Y}_{i}^{a=0}\\right)\\right] \\\\\r\n& =\\frac{1}{n} E\\left[\\sum_{i=1}^{n}\\left(\\frac{A_{i}\\left(Y_{i}-\\hat Y_{i}^{a=1}\\right)}{\\widehat{PS_{i}}}+\\hat Y_{i}^{a=1}\\right)\\right]-\\frac{1}{n} E\\left[\\sum_{i=1}^{n}\\left(\\frac{\\left(1-A_{i}\\right)\\left(Y_{i}-\\hat Y_{i}^{a=0}\\right)}{1-{\\widehat {PS}_{i}}}+\\hat{Y}^{a=0}\\right)\\right] \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^{n}\\left(E\\left[\\frac{A_{i}\\left(Y_{i}-\\hat Y_{i}^{a=1}\\right)}{\\widehat {PS_{i}}}\\right]+E\\left[\\hat Y_{i}^{a=1}\\right]\\right)-\\frac{1}{n} \\sum_{i=1}^{n}\\left(E\\left[\\frac{\\left(1-A_{i}\\right)\\left(Y_{i}-\\hat Y_{i}^{a=0}\\right)}{1-{\\widehat P S_{i}}}\\right]+E\\left[\\hat Y_{i}^{a=0}\\right]\\right) \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\left(\\frac{1}{\\widehat {PS_{i}}}\\right) E\\left[\\left [Y_{i}|A_{i}=1\\right)-E\\left[\\hat Y_{i}^{a=1}|A=1\\right]+\\hat{Y}_{i}^{a=1}\\right)-\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\left(\\frac{1}{1-{\\widehat {PS_{i}}}}\\right) E\\left[Y_i|A_{i}=0]-E[\\hat Y_{i}^{a=0}|A=0\\right]+\\hat{Y}_{i}^{a=0}\\right)\\right. \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\left(\\frac{1}{\\widehat{PS}_{i}}\\right)\\left(\\hat{Y}_{i}^{a=1}-\\hat{Y}_{i}^{a=1}\\right)+\\hat{Y}_{i}^{a=1}\\right)-\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\left(\\frac{1}{1-\\widehat{PS}_{i}}\\right)\\left(\\hat{Y}_{i}^{a=0}-\\hat{Y}_{i}^{a=0}\\right)+\\hat{Y}_{i}^{a=0}\\right) \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\left(\\frac{1}{\\widehat{PS}_{i}}\\right)\\left(0\\right)+\\hat{Y}_{i}^{a=1}\\right)-\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\left(\\frac{1}{1-\\widehat{PS}_{i}}\\right)\\left(0\\right)+\\hat{Y}_{i}^{a=0}\\right) \\\\\r\n& =\\frac{\\sum_{i=1}^{n} \\hat{Y}_{i}^{a=1}}{n}-\\frac{\\sum_{i=1}^{n} \\hat{Y}_{i}^{a=0}}{n} \\\\\r\n& =E\\left[Y^{\\alpha=1}\\right]-E\\left[Y^{\\alpha=0}\\right]\r\n\\end{aligned}}\r\n\\]\r\nWhen REG is misspecified, but IPW is correct\r\nThe second situation is that when we have REG\r\nmodel misspecified: \\[\r\n\\frac{1}{n} \\sum_{i=1}^{n} \\hat{Y}_{i}^{a} \\neq E\\left[Y^{a}\\right]\r\n\\] But our IPW model is correct: \\[\r\n\\begin{aligned}\r\n& \\frac{1}{n} \\sum_{i=1}^{n}\\left(\\frac{E\\left[Y_{i} \\mid A=1\\right]}{\\widehat{P S_i}}\\right)=E\\left[Y^{a=1}\\right] \\\\\r\n& \\frac{1}{n} \\sum_{i=1}^{n}\\left(\\frac{E\\left[Y_{i} \\mid A=0\\right]}{1-\\widehat{P S}_{i}}\\right)=E\\left[Y^{a=0}\\right] \\\\\r\n\\end{aligned}\r\n\\] First, let’s rearrange DRE’s formula a bit:\r\n\\[\r\n\\scriptsize{\r\n\\begin{aligned}\r\n\\widehat{D R E}_{a=1}-\\widehat{D R E}_{a=0}&=\\frac{1}{n} \\sum_{i=1}^n\\left(\\frac{A_i\\left(Y_i-\\hat{Y}_i^{a=1}\\right)}{\\widehat{P S}_i}+\\hat{Y}_i^{a=1}\\right)-\\frac{1}{n} \\sum_{i=1}^n\\left(\\frac{\\left(1-A_i\\right)\\left(Y_i-\\hat{Y}_i^{a=0}\\right)}{1-\\widehat{P S}_i}+\\hat{Y}_i^{a=0}\\right) \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^n\\left(\\frac{A_i Y_i}{\\widehat{P S}_i}-\\frac{A_i \\hat{Y}_i^{a=1}}{\\widehat{P S}_i}+\\hat{Y}_i^{a=1}\\right)-\\frac{1}{n} \\sum_{i=1}^n\\left(\\frac{\\left(1-A_i\\right) Y_i}{1-\\widehat{P S}_i}-\\left(\\frac{\\left(1-A_i\\right) \\hat{Y}_i^{a=0}}{1-\\widehat{P S}_i}\\right)+\\hat{Y}_i^{a=0}\\right) \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^n\\left(\\frac{A_i Y_i}{\\widehat{P S_i}}-\\left(\\frac{A_i \\widehat{Y}_i^{a=1}}{\\widehat{P S_i}}-\\widehat{Y}_i^{a=1}\\right)\\right)-\\frac{1}{n} \\sum_{i=1}^n\\left(\\frac{\\left(1-A_i\\right) Y_i}{1-\\widehat{P S_i}}-\\left(\\frac{\\left(1-A_i\\right) \\hat{Y}_i^{a=0}}{1-\\widehat{P S_i}}-\\widehat{Y}_i^{a=0}\\right)\\right) \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^n\\left(\\frac{A_i Y_i}{\\widehat{P S}_i}-\\hat{Y}_i^{a=1}\\left(\\frac{A_i}{\\widehat{P S}_i}-1\\right)\\right)-\\frac{1}{n} \\sum_{i=1}^n\\left(\\frac{\\left(1-A_i\\right) Y_i}{1-\\widehat{P S}_i}-\\hat{Y}_i^{a=0}\\left(\\frac{\\left(1-A_i\\right)}{1-\\widehat{P S_i}}-1\\right)\\right) \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^n\\left(\\frac{A_i Y_i}{\\widehat{P S}_i}-\\hat{Y}_i^{a=1}\\left(\\frac{A_i-\\widehat{P S}_i}{\\widehat{P S}_i}\\right)\\right)-\\frac{1}{n} \\sum_{i=1}^n\\left(\\frac{\\left(1-A_i\\right) Y_i}{1-\\widehat{P S}_i}-\\hat{Y}_i^{a=0}\\left(\\frac{\\left(1-A_i\\right)-\\left(1-\\widehat{P S}_i\\right)}{1-\\widehat{P S}_i}\\right)\\right) \\\\\r\n&\r\n\\end{aligned}}\r\n\\]\r\nThen the true ACE becomes: \\[\r\n\\scriptsize{\\begin{aligned}\r\nE\\left[\\widehat{D R E_{a=1}}-\\widehat{D R E_{a=0}}\\right]&=E\\left[\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\frac{A_{i} Y_{i}}{\\widehat{P S_{i}}}-\\hat{Y}_{i}^{a=1}\\left(\\frac{A_{i}-\\widehat{P S}_{i}}{\\widehat{P S}_{i}}\\right)\\right)-\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\frac{\\left(1-A_{i}\\right) Y_{i}}{1-\\widehat{P S_{i}}}-\\hat{Y}_{i}^{a=0}\\left(\\frac{\\left(1-A_{i}\\right)-\\left(1-\\widehat{P S_{i}}\\right)}{1-\\widehat{P S} _{i}}\\right)\\right)\\right] \\\\\r\n& =\\frac{1}{n} E\\left[\\sum_{i=1}^{n}\\left(\\frac{A_{i} Y_{i}}{\\widehat{P S_{i}}}-\\hat{Y}_{i}^{a=1}\\left(\\frac{A_{i}-\\widehat{P S_{i}}}{\\widehat{P S_{i}}}\\right)\\right)\\right]-\\frac{1}{n} E\\left[\\sum_{i=1}^{n}\\left(\\frac{\\left(1-A_{i}\\right) Y_{i}}{1-\\widehat{P S}_{i}}-\\hat{Y}_{i}^{a=0}\\left(\\frac{\\left(1-A_{i}\\right)-\\left(1-\\widehat{P S_{i}}\\right)}{1-\\widehat{P S_{i}}}\\right)\\right)\\right] \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^{n}\\left(E\\left[\\frac{A_{i} Y_{i}}{\\widehat{P S}_{i}}\\right]-E\\left[\\hat{Y}_{i}^{a=1}\\left(\\frac{A_{i}-\\widehat{P S}_{i}}{\\widehat{P S} _{i}}\\right)\\right]\\right)-\\frac{1}{n} \\sum_{i=1}^{n}\\left(E\\left[\\frac{\\left(1-A_{i}\\right) Y_{i}}{1-\\widehat{P S} _{i}}\\right]-E\\left[\\hat{Y}_{i}^{a=0}\\left(\\frac{\\left(1-A_{i}\\right)-\\left(1-\\widehat{P S_{i}}\\right)}{1-\\widehat{P S_{i}}}\\right)\\right]\\right) \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\left(\\frac{1}{\\widehat{P S}_{i}}\\right) E\\left[Y_{i}|A=1\\right]-\\left(\\frac{\\hat{Y}_{i}^{a=1}}{\\widehat{P S_{i}}}\\right) E\\left[A_{i}-\\widehat{P S}_{i}\\right]\\right)-\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\left(\\frac{1}{1-\\widehat{P S_{i}}}\\right) E\\left[Y_{i}|A=0\\right]-\\left(\\frac{\\hat{Y}_{i}^{a=0}}{1-\\widehat{P S_{i}}}\\right) E\\left[\\left(1-A_{i}\\right)-\\left(1-\\widehat{P S_{i}}\\right)\\right]\\right) \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\left(\\frac{1}{\\widehat{P S}_{i}}\\right)  E\\left[Y_{i}|A=1\\right]-\\left(\\frac{\\hat{Y}_{i}^{a=1}}{\\widehat{P S}_{i}}\\right)\\left(E\\left[A_{i}\\right]-\\widehat{P S_{i}}\\right)\\right)-\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\left(\\frac{1}{1-\\widehat{P S}_{i}}\\right)  E\\left[Y_{i}|A=0\\right]-\\left(\\frac{\\hat{Y}_{i}^{a=0}}{1-\\widehat{P S}_{i}}\\right)\\left(E\\left[\\left(1-A_{i}\\right)\\right]-\\left(1-\\widehat{P S_{i}}\\right)\\right)\\right) \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\left(\\frac{1}{\\widehat{P S}_{i}}\\right) E\\left[Y_{i} \\mid A=1\\right]-\\left(\\frac{\\widehat{Y}_{i}^{a=1}}{\\widehat{P S}_{i}}\\right)\\left(\\widehat{P S}_{i}-\\widehat{P S}_{i}\\right)\\right)-\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\left(\\frac{1}{1-\\widehat{P S}_{i}}\\right) E\\left[Y_{i} \\mid A=0\\right]-\\left(\\frac{\\hat{Y}_{i}^{a=0}}{1-\\widehat{P S}_{i}}\\right)\\left(\\left(1-\\widehat{P S}_{i}\\right)-\\left(1-\\widehat{P S_{i}}\\right)\\right)\\right) \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\frac{E\\left[Y_{i} \\mid A=1\\right]}{\\widehat{P S}_{i}}-\\left(\\frac{\\hat{Y}_{i}^{a=1}}{\\widehat{P S}_{i}}\\right)(0)\\right)-\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\frac{E\\left[Y_{i} \\mid A=0\\right]}{1-\\widehat{P S}_{i}}-\\left(\\frac{\\hat{Y}_{i}^{a=0}}{1-\\widehat{P S}_{i}}\\right)(0)\\right) \\\\\r\n& =\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\frac{E\\left[Y_{i} \\mid A=1\\right]}{\\widehat{P S}_{i}}\\right)-\\frac{1}{n} \\sum_{i=1}^{n}\\left(\\frac{E\\left[Y_{i} \\mid A=0\\right]}{1-\\widehat{P S}_{i}}\\right) \\\\\r\n& =E\\left[Y^{a=1}\\right]-E\\left[Y^{a=0}\\right]\r\n\\end{aligned}}\r\n\\]\r\nIn either case, we prove that DRE’s unbiasedness\r\nin estimating the true average causal effects\r\nholds even though either of IPW/REG has been\r\nwrongly specified (but the other has to be\r\ncorrectly modeled). But it fails to work if both\r\ninverse-probability weighting model (IPW) and\r\noutcome regression model (REG) are incorrect.\r\n\r\n\r\n\r\n",
      "last_modified": "2023-04-14T10:52:27-05:00"
    },
    {
      "path": "index.html",
      "title": "Causal Inference: Doubly Robust Estimator",
      "description": "Welcome to the website. This website introduces Doubly Robust Estimator (DRE) in causal inference. This is a class project from course STAT 451: Causal Inference at Macalester College. The contents in this blog are collaborative efforts from Kristy Ma and Xiang Li.\n",
      "author": [],
      "contents": "\r\nTable of contents\r\nTo start exploring, please simply navigate to tabs on the upper right corner. We will start by introducing causal inference and motivation behind this project, then diving into mathematical aspect of Doubly Robust Estimator (DRE), and ending up with a simply computation simulation study. Have fun!\r\nIf you have any questions, please reach out to yma1@macalester.edu and xli2@macalester.edu. Thank you!\r\n\r\n\r\n\r\n",
      "last_modified": "2023-04-14T10:52:27-05:00"
    },
    {
      "path": "reg-ipw.html",
      "title": "Outcome Regression and Inverse Probability Weighting",
      "author": [],
      "contents": "\r\nPre DRE: Two common adjusting methods\r\nOutcome regression (REG)\r\nInverse Probability Weighting (IPW)\r\n\r\n\r\n\r\n",
      "last_modified": "2023-04-14T10:52:27-05:00"
    },
    {
      "path": "sim.html",
      "title": "Doubly Robust Estimation of Causal Effects in R",
      "description": "Some additional details about the website",
      "author": [],
      "contents": "\r\nComputational Simulation\r\nGoal: estimate a causal effect when you do not have data from a randomized experiment\r\nStrategy 1: Re-weighting each observation by the probability of receiving A or B so that the data approximates a randomized experiment\r\nStrategy 2: Modelling the outcome directly with a linear regression\r\nCombining Idea 1 and 2: To form doubly robust estimator\r\nSetting up data\r\nWe assign \\(X_1\\) and \\(X_2\\) as causal variables, and define a true ACE of 10.\r\n\r\n\r\nsimu_observational_data <- function(simu_id = 1, n_obs) {\r\n  X_1    <- rnorm(n_obs)\r\n  X_2    <- rnorm(n_obs)\r\n  XB     <- 0.2*X_1 + 0.2*X_2\r\n  prob_A <- exp(XB) / (1 + exp(XB))\r\n  A      <- rbinom(n_obs, 1, prob_A)\r\n  \r\n  # The causal effect of treatment A is 10\r\n  Y      <- 100 + X_1 + X_2 + 10*A + rnorm(n_obs) \r\n  \r\n  # summarize variables into a data frame\r\n  data.frame(simu_id = simu_id, n_obs = n_obs, \r\n             var_1 = X_1, var_2 = X_2, \r\n             treatment = A, outcome = Y)  \r\n} \r\n\r\n\r\nIPW model\r\n\r\n\r\nprop_score_model <- function(data) {\r\n  glm(treatment ~ var_1 + var_2, data = data, family = 'binomial')\r\n}\r\n\r\n\r\n\r\n\r\nprop_score_model_w <- function(data) {\r\n  # OOPS! I forgot var_2\r\n  glm(treatment ~ var_1, data = data, family = 'binomial')\r\n}\r\n\r\n\r\n\r\n\r\n#IPW correct\r\nipw_estimator <- function(data, model) {\r\n  data %>% \r\n    mutate(\r\n      prob = predict(model, newdata = data, type = 'response'),\r\n    ) %>% \r\n    summarise(\r\n      EY0_ipw = mean(outcome*(1 - treatment) / (1 - prob)),\r\n      EY1_ipw = mean(outcome*treatment / prob)\r\n    ) %>% \r\n    mutate(ipw = EY1_ipw - EY0_ipw)\r\n}\r\n\r\n\r\n\r\n\r\n# IPW wrong\r\nipw_estimator_w <- function(data, model) {\r\n  data %>% \r\n    mutate(\r\n      prob = predict(model, newdata = data, type = 'response'),\r\n    ) %>% \r\n    summarise(\r\n      EYB_ipw = mean(outcome*(1 - treatment) / (1 - prob)),\r\n      EYA_ipw = mean(outcome*treatment / prob)\r\n    ) %>% \r\n    mutate(ipw_w = EYA_ipw - EYB_ipw)\r\n}\r\n\r\n\r\nREG model\r\n\r\n\r\nmean_outcome_model <- function(data) {\r\n  glm(outcome ~ treatment + var_1 + var_2, data = data)\r\n}\r\n\r\n\r\n\r\n\r\nmean_outcome_model_w <- function(data) {\r\n  # MISSING var_2??!?!\r\n  glm(outcome ~ var_1 + treatment, data = data)\r\n}\r\n\r\n\r\n\r\n\r\n#REG correct\r\noutcome_model_estimator <- function(data) {\r\n   mean_model <- mean_outcome_model(data) # Compute the model\r\n   summary(mean_model)$coefficients['treatment', ][1] # Coefficient for treatment\r\n}\r\n\r\n\r\n\r\n\r\n# REG wrong\r\noutcome_model_estimator_w <- function(data) {\r\n   mean_model <- mean_outcome_model_w(data)\r\n   summary(mean_model)$coefficients['treatment', ][1]\r\n}\r\n\r\n\r\nDRE estimator\r\n\r\n\r\ndr_estimator <- function(data, prop_model, mean_model) {\r\n  data %>% \r\n    mutate(\r\n      prob = predict(prop_model, newdata = data, type = 'response'),\r\n      pred = predict(mean_model, newdata = data, type = 'response'),\r\n      augm = (treatment - prob)*pred\r\n    ) %>% \r\n    summarise(\r\n      EY0_dr = mean((outcome*(1 - treatment) - augm) / (1 - prob)),\r\n      EY1_dr = mean((outcome*treatment - augm) / prob)\r\n    ) %>% \r\n    mutate(dre = EY1_dr - EY0_dr)\r\n}\r\n\r\n\r\nNow, we have five models: IPW (both correct and incorrect), REG (both correct and incorrect), and DRE.\r\nStrategy 1: Inverse Probability Weighting (IPW)\r\nIntuition Behind it\r\nIn an experiment the probability of receiving a treatment are always equal across all units (i.e., 50%)\r\nIn the current case, the probability of receiving the treatment depends on variables that affect the outcome\r\nIf we knew what this probabilities are we could re-weight our sample such that the data would better match a randomized experiment\r\nIn the re-weighting scheme, units that were very likely to receive the treatment are weighted down and units that were very unlikely to receive the treatment are weighted up\r\nReminder: propensity score is just a logistic regression of the probability of receiving the treatment\r\nIn our example, we proposed the\r\n\r\n\r\nprop_score_model <- function(data) {\r\n  glm(treatment ~ var_1 + var_2, data = data, family = 'binomial')\r\n}\r\n\r\n\r\nStrategy 1: IPW estimator\r\nSimilar to a difference of means but weights each observation inversely proportional to its probability of receiving a treatment\r\n\\[\\widehat {PS}_i=\\pi(X_{i})\\]\r\n\\[\\hat{\\delta}_{IPW} = \\frac{1}{n}\\sum_{i=1}^{n}\\bigg[\\frac{Y_{i}A_{i}}{\\color{red}{\\pi(X_{i})}} - \\frac{Y_{i}(1-A_{i})}{\\color{red}{1-\\pi(X_{i})}}\\bigg]\\]\r\n\r\n\r\nipw_estimator <- function(data, model) {\r\n  data %>% \r\n    mutate(\r\n      prob = predict(model, newdata = data, type = 'response'),\r\n    ) %>% \r\n    summarise(\r\n      EYB_ipw = mean(outcome*(1 - treatment) / (1 - prob)),\r\n      EYA_ipw = mean(outcome*treatment / prob)\r\n    ) %>% \r\n    mutate(ipw = EYA_ipw - EYB_ipw)\r\n}\r\n\r\n\r\nclass: center\r\n# IPW Performance\r\n\r\n\r\n\r\nIPW could fail\r\nIf the model for A is incorrect, it would cause bias in the IPW, which cause IPW to fail.\r\n\r\n\r\n\r\nWe overestimated the true ACE (which is 10) if we wrongly specified the model form in IPW setting.\r\nStrategy 2: REG estimator (model the outcome)\r\nDefault strategy of data scientist would be to create a linear model\r\n\\[Y =\\alpha_0 + \\alpha_1 X_1 + \\alpha_2 X_2 +\\delta A+ \\varepsilon\\]\r\nUse \\(\\hat{\\delta}\\) as the estimator of the causal effect\r\n\r\n\r\nmean_outcome_model <- function(data) {\r\n  glm(outcome ~ var_1 + var_2 + treatment, data = data)\r\n}\r\n\r\n\r\n\r\n\r\noutcome_model_estimator <- function(data) {\r\n   mean_model <- mean_outcome_model(data)\r\n   summary(mean_model)$coefficients['treatment', ][1]\r\n}\r\n\r\n\r\nclass: center\r\n# Strategy 2: Performance - Simulation\r\n\r\n\r\n\r\nREG model could also fail\r\nIf the model for Y is incorrect (as we recalled we left var_2 out), it would cause bias in the REG outcome model, which cause the model to fail.\r\n\r\n\r\nmean_model_estimator_w <- \r\n  mean(nested_df$model_estimate_w)\r\n\r\nnested_df %>% \r\n  ggplot(aes(x = simu_id, y = model_estimate_w)) +\r\n  ggtitle(paste('The mean of the REG estimate (incorrectly specified) is ', round(mean_model_estimator_w, 2))) + \r\n  geom_point(color = 'blue') +\r\n  geom_hline(yintercept = 10) +\r\n  theme_bw()\r\n\r\n\r\n\r\nWe also overestimated the true ACE (10) if our REG model is mis-specified.\r\nCombining Strategy 1 and 2\r\n–\r\nIf the propensity score model is incorrect, strategy 1 will not work\r\n–\r\nIf the outcome model is incorrect, strategy 2 will not work\r\n–\r\nIf you combine both approaches, you just need either one to work but not both\r\n–\r\nAs a data scientist you have 1 out of 2 chances to get the correct answer\r\n–\r\nThis is called the doubly robustness property\r\nThis could also fail but is less likely to do so\r\nCombining Strategy 1 and 2 - Doubly Robust Estimator\r\n\\[\\hat{\\delta}_{DR} = \\frac{1}{n}\\sum_{i=1}^{n}\\bigg[\\frac{Y_{i}A_{i} -\\color{red}{(A_i-\\pi(X_{i}))\\mu(X_i, A_i)}}{\\pi(X_{i})} - \\frac{Y_{i}(1-A_{i}) -\\color{red}{(A_i-\\pi(X_{i}))\\mu(X_i, A_i)}}{1-\\pi(X_{i})}\\bigg]\\]\r\nwhere \\[\\mu(X, A) = \\hat{\\alpha}_0 + \\hat{\\alpha}_1 X_1 + \\hat{\\alpha}_2 X_2 +\\hat{\\delta} A\\]\r\nThe term in red is said to augment the IPW estimator\r\nIt can be shown that this estimator will consistently estimate \\(\\delta = E[Y(A)]-E[Y(B)]\\) as long as either \\(\\pi(X_{i})\\) or \\(\\mu(X, A)\\) are correct\r\nCombining Strategy 1 and 2 - Doubly Robust Estimator\r\n\r\n\r\ndr_estimator <- function(data, prop_model, mean_model) {\r\n  data %>% \r\n    mutate(\r\n      prob = predict(prop_model, newdata = data, type = 'response'),\r\n      pred = predict(mean_model, newdata = data, type = 'response'),\r\n      augm = (treatment - prob)*pred\r\n    ) %>% \r\n    summarise(\r\n      EYB_dr = mean((outcome*(1 - treatment) - augm) / (1 - prob)),\r\n      EYA_dr = mean((outcome*treatment - augm) / prob)\r\n    ) %>% \r\n    mutate(dre = EYA_dr - EYB_dr)\r\n}\r\n\r\n\r\nclass: center\r\n# DRE Performance\r\n\r\n\r\n\r\nDoubly Robust Estimator - Propensity Score is Incorrect\r\n\r\n\r\nprop_score_model <- function(data) {\r\n  # OOPS! I forgot var_2\r\n  glm(treatment ~ var_1, data = data, family = 'binomial')\r\n}\r\n\r\n\r\nclass: center\r\n# Doubly Robust Estimator - Propensity Score is Incorrect\r\n\r\n\r\n\r\n\r\n\r\n\r\n# Doubly Robust Estimator - Mean Model is Incorrect\r\n\r\n# Doubly Robust Estimator - Mean Model is Incorrect\r\n\r\n\r\n\r\n\r\nConclusion\r\nIf you have non randomized data you cannot simply calculate the difference in means between \\(A\\)\r\nand \\(B\\) to estimate the causal effect\r\nYou can use the IPW estimator based on a logistic regression of the probability of receiving the treatment\r\nYou can model the outcome based on a linear regression with the confounding variables as well as \\(A\\)\r\nOr you can use the doubly robust estimator which will work as long as either the logistic or the linear regression are correct, but not both\r\nReferences\r\nLunceford, Jared K., and Marie Davidian. “Stratification and weighting via the propensity score in estimation of causal treatment effects: a comparative study.” Statistics in medicine 23.19 (2004): 2937-2960.\r\n\r\n\r\n\r\n",
      "last_modified": "2023-04-16T15:25:17-05:00"
    },
    {
      "path": "wrapup.html",
      "title": "Wrap-up and Conclusion",
      "description": "Some additional details about the website",
      "author": [],
      "contents": "\r\nTitle\r\n\r\n\r\n\r\n",
      "last_modified": "2023-04-14T10:52:27-05:00"
    }
  ],
  "collections": []
}
